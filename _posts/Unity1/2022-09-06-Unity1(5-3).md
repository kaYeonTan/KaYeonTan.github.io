---
title:  "Unity Chapter 5."
excerpt: "캐릭터와 GUI 컨트롤 하기 `5-3`

categories:
  - unity1
tags:
  - [Unity, Game Engine]

toc: true
toc_sticky: true
 
date: 2022-09-06
last_modified_at: 2022-09-06
---
--- 
<span style="background-color:#E2A63B">요시야 마키토가 지은 **유니티 5로 만드는 3D/2D 스마트폰 게임 개발**을 보고 정리한 내용이다.</span>  
<br>
<br>
<br> 
**<span style="color:#5E784F">액션 게임(Nejiko Run)</span>**  
<br>
<br>

#### Chapter 5-3. 네지코 작성
---

##### CharacterController 설정

캐릭터 오브젝트(이하 네지코)를 움직이게 하려면 **CharacterController**라는 컴포넌트를 사용한다. 
`CharacterController` Collider와 Rigidbody의 기능을 합친 듯한 컴포넌트. 캐릭터의 움직임을 처리할 수 있다.  

![image](https://user-images.githubusercontent.com/106606698/188611930-88ff215f-4bca-4107-bd68-c25e9efcf733.png)
 
씬 뷰를 보면서 네지코 외형과 CharacterController 콜라이더를 조절한다.  
 
![image](https://user-images.githubusercontent.com/106606698/188612791-dfb77f4b-ee0e-4857-a3db-45c1d1f8ef1a.png)
 
그 다음 테스트 스테이지를 설치한다.  

![image](https://user-images.githubusercontent.com/106606698/188613243-5d5976af-bab4-43da-84c5-49a62485c8a3.png)

<br>
<br>

##### CharacterController 이용   

네지코의 움직임을 제어하는 스크립트를 만든다. 스크립트는 물리적인 움직임을 CharacterController를 통해 실시하고, 외형의 움직임을 Animator를 통해 실시한다.  
 
CharacterController로 캐릭터를 이동시킬 경우, 움직이고 싶은 방향의 벡터를 Move 함수에 전달한다. (CharacterController는 Rigidbody와 달리 중력 계산을 자동으로 실시하지 않는다. 따라서 중력도 고려하며 계산한다.) Animator의 제어는 SetBool과 SetTrigger등의 함수를 이용해 파라미터를 전달한다.  

```c#
public class NejikoController : MonoBehaviour
{
    CharacterController controller;
    Animator animator;

    Vector3 moveDirection = Vector3.zero;

    public float gravity;
    public float speedZ;
    public float speedJump;

    void Start()
    {
        //필요한 컴포넌트 자동 취득 (1)
        controller = GetComponent<CharacterController>();
        animator = GetComponent<Animator>();        
    }

    void Update()
    {
        //지상에 있을 경우만 조작한다.
        if(controller.isGrounded) //(2)
        {
            //Input을 감지하여 앞으로 전진한다.
            if(Input.GetAxis("Vertical") > 0.0f) //(3)
            {
                moveDirection.z = Input.GetAxis("Vertical") * speedZ;
            }
            else
            {
                moveDirection.z = 0;
            };

            //방향전환(4)
            transform.Rotate(0, Input.GetAxis("Horizontal") * 3, 0);

            //점프(5)
            if(Input.GetButton("Jump"))
            {
                moveDirection.y = speedJump;
                animator.SetTrigger("jump");
            };
        };
        //중력만큼의 힘을 매 프레임에 추가 (6)
        moveDirection.y -= gravity * Time.deltaTime;
        //이동실행(7)
        Vector3 globalDirection = transform.TransformDirection(moveDirection);
        controller.Move(globalDirection * Time.deltaTime);
         //이동 후 접지하고 있으면 Y의 방향속도는 리셋한다.
        if (controller.isGrounded) moveDirection.y = 0;
        //속도가 0 이상이면 달리고 있는 플래그를 true로 한다. (8)
        animator.SetBool("run", moveDirection.z > 0.0f);
    }
}
```  

`(1) 컴포넌트 취득` CharacterController와 Animator를 취득한다.  
`(2) 접지하고 있는지를 판정` CharacterController의 isGrounded에 의해 캐릭터가 지면에 있는지를 판정한다. 지면에 있을 때만 키 입력을 받는다.  
`(3) 전진속도 설정` Input.GetAxis 함수에 의해 수직방향의 입력을 취득하면 전진하는 속도를 설정한다.  
`(4) 방향회전` 가로방향 입력을 취득하여 y축을 중심으로 캐릭터를 회전시킨다.
`(5) 점프처리` Input으로 Jump에 할당된 키 입력이 있으면 위쪽 방향으로 jumpSpeed를 적용하고, Animator에 대해 jump 트리거를 건네서 애니메이션을 전환한다.  
`(6) 중력의 가산` 매 프레임마다 중력만큼의 속도를 아래쪽으로 가한다.  
`(7) 캐릭터 이동` TransformDirection 함수에 의해 지금까지 계산한 로컬의 이동 벡터를 씬의 글로벌 값으로 변환한다. 그것을 Move에 전달해 캐릭터의 이동을 실행한다.(deltaTime을 곱해 프레임 속도의 차이에 의한 영향을 없애고 있다.)  
`(8) Idle 및 Run 애니메이션 제어` Animation에 현재 캐릭터의 이동 상태 파라미터를 전달한다. moveDirection.z값이 0보다 크면 달리고 있다 판단해 run 파라미터를 true로 전환한다.  

![image](https://user-images.githubusercontent.com/106606698/188620310-300fa40f-3fe5-4b02-8d45-cd812d907eb2.png)

키를 입력하면 네지코의 움직임과 애니메이션의 전환을 볼 수 있다.

![image](https://user-images.githubusercontent.com/106606698/188621644-9bd78d59-6c64-40ef-9bee-381090a1c34c.png)

<br>
<br>

##### 프로젝터에 의한 그림자    

캐릭터의 그림자를 설정한다. **Effects**패키지 안에  포함된 